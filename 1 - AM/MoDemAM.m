%% Modulação AM - configuraçãoclear all;clc;close all;pkg load control;                  % carrega o pacote de controlepkg load symbolic;   vis = 1;                           % habilita gráfico quando 1%% definindo o númerode harmônicas envolvidas na análise / sintese                 N = 100;          % Número de harmônicas para análise%% Definindo a mensagem - m(t)%% Ona pulsada de dois níveis, período To e largura tau  sinal.tipo       ="quadrada"      % Define tipo de sinal  sinal.Ap         = 1;             % Amplitude em nível alto  sinal.An         = 0;             % Amplitude em nível baixo  sinal.largura    = 0.5;           % Duração em nível alto  sinal.periodo    = 1;             % Período  sinal.harmonicas = N;             % Número de harmônicas%%%%%%%%% Análise  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Analisando a mensagem - m(t) %% Tempo para frequência  [D_o,Dn,f,Pg,PN] = sFourier(sinal);  disp("Valor Médio:"); D_o  disp("Potência:"); Pg  disp("Potência (N):"); PN(end)  %%%%%%%%% Síntese  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%% Definindo o vetor de sintese  sintese.pontos   = 1000;  sintese.periodos = 2;  sintese.periodo  = sinal.periodo;  sintese.Dn       = Dn;  sintese.N        = sinal.harmonicas; %% Sintetizando o sinal%% Frequência para tempo  [tempo,mensagem] = sinteseFourier (sintese);%%%%%%%%% Modulação  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %% Portadora do sinal modulado    To = sinal.periodo;  wc = 100*pi/To;            % 10 vezes maior que a mensagem  portadora = cos(wc*tempo); % portadora sem mensagem %% Sinal modulado  AM_mod = portadora.*mensagem;  %%%%%%%%% Análise espectral  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Sinal modulado  AM.tipo       ="AMquadrada"    % Define tipo de sinal  AM.Ap         = 1;             % Amplitude em nível alto  AM.An         = 0;             % Amplitude em nível baixo  AM.largura    = 0.5;           % Duração em nível alto  AM.periodo    = 1;             % Período  AM.harmonicas = N;             % Número de harmônicas  AM.portadora  = wc;            % frequência da portadora  %%%%%%%%% Análise  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Analisando o sinal modulado - AM_mod(t) %% Tempo para frequência  [D_om,Dnm,fm,Pgm,PNm] = sFourier(AM);  disp("Valor Médio:"); D_om  disp("Potência:"); Pgm  disp("Potência (N):"); PNm(end)  %%%%%%%%% Síntese  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%% Definindo o vetor de sintese  sintese.pontos   = 1000;  sintese.periodos = 2;  sintese.periodo  = sinal.periodo;  sintese.Dn       = Dnm;  sintese.N        = sinal.harmonicas; %% Sintetizando o sinal%% Frequência para tempo  [tempo,modulado] = sinteseFourier (sintese);  %%%%%%%%% Demodulando  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %% Definindo a mensagem - m(t)%% Ona pulsada de dois níveis, período To e largura tau  AMod.tipo       ="demodulado";   % Define tipo de sinal  AMod.Ap         = 1;             % Amplitude em nível alto  AMod.An         = 0;             % Amplitude em nível baixo  AMod.largura    = 0.5;           % Duração em nível alto  AMod.periodo    = 1;             % Período  AMod.harmonicas = N;             % Número de harmônicas  AMod.portadora  = wc;            % frequência da portadora%%%%%%%%% No tempo  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Simulando um diodo ideal  AM_diodo = abs(modulado.*(modulado>1));  %%%%%%%%% Filtrando o sinal %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Definindo o filtro e ser utilizado%% Criando o filtro passa baixas - FPBwc = 10*pi;                          % frequência de corteHFPB = tf(wc,[1 wc]);HFPB1 = series(HFPB,HFPB);HFPB2 = series(HFPB1,HFPB);%% Filtragem do sinal utilizando lsimm_filtro  = lsim(HFPB,AM_diodo,tempo);m_filtro2 = lsim(HFPB1,AM_diodo,tempo);m_filtro3 = lsim(HFPB2,AM_diodo,tempo);  %%%%%%%%% Visualização  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%if vis == 1    %%% Visualizando os espectrosfigure(1) stem(f,abs(Dn),"linewidth", 3); title('Serie de Fourier do sinal g(t)');xlabel('Frequencia em Hz');ylabel('Amplitude em  volts') set(gca, "linewidth", 3, "fontsize", 13) %%% Visualizando o sinal reconstruidofigure(2)plot(tempo,mensagem,"linewidth", 3)title('Reconstrucao do sinal g(t)');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')set(gca, "linewidth", 3, "fontsize", 13)%%% Visualizando a potência em função da frequênciafigure(3)plot(f(N+1:end),PN,f(N+1:end),ones(1,N+1)*Pg,"linewidth", 3)title('Potencia total e em funcao do harmonico');xlabel('Harmônico');ylabel('Potencia em W')set(gca, "linewidth", 3, "fontsize", 13)figure(4)set(gca, "linewidth", 3, "fontsize", 13)subplot(1,2,1),plot(tempo,mensagem,"linewidth", 3)title('Mensagem - m(t)');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')subplot(1,2,2),plot(tempo,AM_mod,"linewidth", 3)title('Sinal modulado - AM(t)');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')figure(5) set(gca, "linewidth", 3, "fontsize", 13)subplot(2,1,1),stem(f,abs(Dn),"linewidth", 3); title('Serie de Fourier da mensagem');xlabel('Frequencia em Hz');ylabel('Amplitude em  volts') subplot(2,1,2),stem(f,abs(Dnm),"linewidth", 3); title('Serie de Fourier do sinal AM');xlabel('Frequencia em Hz');ylabel('Amplitude em  volts') %%% Visualizando o sinal modulado reconstruidofigure(6)plot(tempo,modulado,"linewidth", 3)title('Reconstrucao do sinal modulado');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')set(gca, "linewidth", 3, "fontsize", 13)figure(7) set(gca, "linewidth", 3, "fontsize", 13)subplot(2,2,1),plot(tempo,mensagem,"linewidth", 3)title('Reconstrucao da mensagem');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')subplot(2,2,2),plot(tempo,m_filtro,"linewidth", 3)title('Mensanegm recuperada - ordem 1');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')subplot(2,2,3),plot(tempo,m_filtro2,"linewidth", 3)title('Mensanegm recuperada - ordem 2');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')subplot(2,2,4),plot(tempo,m_filtro3,"linewidth", 3)title('Mensanegm recuperada - ordem 3');xlabel('Tempo em segundos');ylabel('Amplitude em  volts')end  